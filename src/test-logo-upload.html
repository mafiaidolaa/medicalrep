<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ø§Ø®ØªØ¨Ø§Ø± Ø±ÙØ¹ Ø§Ù„Ø´Ø¹Ø§Ø±Ø§Øª</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 600px;
            margin: 0 auto;
        }
        .test-button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
            font-size: 16px;
        }
        .test-button:hover {
            background-color: #0056b3;
        }
        .test-button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        .result {
            margin-top: 20px;
            padding: 10px;
            border-radius: 5px;
            background-color: #f8f9fa;
            border-left: 4px solid #007bff;
        }
        .preview-image {
            max-width: 200px;
            max-height: 100px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 10px 0;
        }
        .error {
            color: #dc3545;
            background-color: #f8d7da;
            border-left-color: #dc3545;
        }
        .success {
            color: #155724;
            background-color: #d4edda;
            border-left-color: #28a745;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ğŸ§ª Ø§Ø®ØªØ¨Ø§Ø± ÙˆØ¸Ø§Ø¦Ù Ø±ÙØ¹ Ø§Ù„Ø´Ø¹Ø§Ø±Ø§Øª</h1>
        <p>Ù‡Ø°Ø§ Ø§Ø®ØªØ¨Ø§Ø± Ù„ÙˆØ¸Ø§Ø¦Ù Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª ÙÙŠ Ù…ÙƒÙˆÙ† Ø§Ù„Ù‡ÙˆÙŠØ© Ø§Ù„Ø¨ØµØ±ÙŠØ©</p>
        
        <div>
            <button id="testBasicUpload" class="test-button">ğŸ–¼ï¸ Ø§Ø®ØªØ¨Ø§Ø± Ø±ÙØ¹ ØµÙˆØ±Ø© Ø£Ø³Ø§Ø³ÙŠ</button>
            <button id="testMainLogo" class="test-button">ğŸ¢ Ø§Ø®ØªØ¨Ø§Ø± Ø±ÙØ¹ Ø§Ù„Ø´Ø¹Ø§Ø± Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ</button>
            <button id="testIconLogo" class="test-button">ğŸ“± Ø§Ø®ØªØ¨Ø§Ø± Ø±ÙØ¹ Ø§Ù„Ø£ÙŠÙ‚ÙˆÙ†Ø©</button>
            <button id="testWatermarkLogo" class="test-button">ğŸ’§ Ø§Ø®ØªØ¨Ø§Ø± Ø±ÙØ¹ Ø§Ù„Ø¹Ù„Ø§Ù…Ø© Ø§Ù„Ù…Ø§Ø¦ÙŠØ©</button>
        </div>
        
        <div id="result" class="result" style="display: none;"></div>
        
        <div id="console-output">
            <h3>ğŸ“ Ø³Ø¬Ù„ Ø§Ù„Ø¹Ù…Ù„ÙŠØ§Øª:</h3>
            <div id="console" style="background: #000; color: #0f0; padding: 10px; border-radius: 4px; font-family: monospace; min-height: 100px; overflow-y: auto;"></div>
        </div>
    </div>

    <script>
        // Ø¥Ø¹Ø§Ø¯Ø© Ø¥Ù†Ø´Ø§Ø¡ ÙˆØ¸Ø§Ø¦Ù Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª Ù„Ù„Ø§Ø®ØªØ¨Ø§Ø±
        
        function log(message, type = 'info') {
            const console = document.getElementById('console');
            const time = new Date().toLocaleTimeString('ar-SA');
            const color = type === 'error' ? '#f00' : type === 'success' ? '#0f0' : '#fff';
            console.innerHTML += `<div style="color: ${color};">[${time}] ${message}</div>`;
            console.scrollTop = console.scrollHeight;
            
            // Ø£ÙŠØ¶Ø§Ù‹ ÙÙŠ console Ø§Ù„Ù…ØªØµÙØ­
            console[type === 'error' ? 'error' : 'log'](`[${time}] ${message}`);
        }
        
        function showResult(message, isSuccess = true) {
            const result = document.getElementById('result');
            result.style.display = 'block';
            result.className = `result ${isSuccess ? 'success' : 'error'}`;
            result.innerHTML = message;
        }
        
        // ÙˆØ¸ÙŠÙØ© Ø¥Ù†Ø´Ø§Ø¡ file input
        function createFileInput(options = {}) {
            return new Promise((resolve) => {
                log('Ø¥Ù†Ø´Ø§Ø¡ file input...', 'info');
                
                const defaultOptions = {
                    maxSizeBytes: 5 * 1024 * 1024,
                    allowedTypes: ['image/jpeg', 'image/png', 'image/webp', 'image/svg+xml']
                };
                
                const opts = { ...defaultOptions, ...options };
                
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = opts.allowedTypes.join(',');
                input.style.display = 'none';
                
                input.onchange = (event) => {
                    try {
                        const target = event.target;
                        const file = target.files?.[0] || null;
                        
                        if (file) {
                            log(`ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù: ${file.name} (${(file.size / 1024).toFixed(2)} KB, ${file.type})`, 'success');
                        } else {
                            log('Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø£ÙŠ Ù…Ù„Ù', 'error');
                        }
                        
                        if (document.body.contains(input)) {
                            document.body.removeChild(input);
                        }
                        resolve(file);
                    } catch (error) {
                        log(`Ø®Ø·Ø£ ÙÙŠ onchange: ${error.message}`, 'error');
                        if (document.body.contains(input)) {
                            document.body.removeChild(input);
                        }
                        resolve(null);
                    }
                };
                
                input.oncancel = () => {
                    log('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù', 'info');
                    if (document.body.contains(input)) {
                        document.body.removeChild(input);
                    }
                    resolve(null);
                };
                
                // Ø¥Ø¶Ø§ÙØ© timeout Ù„Ù„Ø£Ù…Ø§Ù†
                const timeout = setTimeout(() => {
                    log('Ø§Ù†ØªÙ‡Øª Ù…Ù‡Ù„Ø© Ø§Ù†ØªØ¸Ø§Ø± Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù', 'error');
                    if (document.body.contains(input)) {
                        document.body.removeChild(input);
                    }
                    resolve(null);
                }, 60000);
                
                try {
                    document.body.appendChild(input);
                    log('ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù...', 'info');
                    input.click();
                    
                    input.addEventListener('change', () => clearTimeout(timeout));
                    input.addEventListener('cancel', () => clearTimeout(timeout));
                } catch (error) {
                    log(`Ø®Ø·Ø£ ÙÙŠ ÙØªØ­ Ù†Ø§ÙØ°Ø© Ø§Ù„Ù…Ù„Ù: ${error.message}`, 'error');
                    clearTimeout(timeout);
                    resolve(null);
                }
            });
        }
        
        // ÙˆØ¸ÙŠÙØ© Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…Ù„Ù
        function validateFile(file, options = {}) {
            const defaultOptions = {
                maxSizeBytes: 5 * 1024 * 1024,
                allowedTypes: ['image/jpeg', 'image/png', 'image/webp', 'image/svg+xml']
            };
            
            const opts = { ...defaultOptions, ...options };
            
            // ÙØ­Øµ Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù
            if (!opts.allowedTypes.includes(file.type)) {
                return {
                    valid: false,
                    error: `Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù ØºÙŠØ± Ù…Ø¯Ø¹ÙˆÙ…. Ø§Ù„Ø£Ù†ÙˆØ§Ø¹ Ø§Ù„Ù…Ø¯Ø¹ÙˆÙ…Ø©: ${opts.allowedTypes.join(', ')}`
                };
            }
            
            // ÙØ­Øµ Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù
            if (file.size > opts.maxSizeBytes) {
                const maxSizeMB = (opts.maxSizeBytes / (1024 * 1024)).toFixed(1);
                return {
                    valid: false,
                    error: `Ø­Ø¬Ù… Ø§Ù„Ù…Ù„Ù ÙƒØ¨ÙŠØ± Ø¬Ø¯Ø§Ù‹. Ø§Ù„Ø­Ø¯ Ø§Ù„Ø£Ù‚ØµÙ‰: ${maxSizeMB} Ù…ÙŠØ¬Ø§Ø¨Ø§ÙŠØª`
                };
            }
            
            return { valid: true };
        }
        
        // ÙˆØ¸ÙŠÙØ© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù
        function processFileUpload(file, options = {}) {
            return new Promise((resolve) => {
                log(`Ø¨Ø¯Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù: ${file.name}`, 'info');
                
                // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù…Ù„Ù
                const validation = validateFile(file, options);
                if (!validation.valid) {
                    log(`ÙØ´Ù„ Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ù„Ù: ${validation.error}`, 'error');
                    resolve({
                        success: false,
                        error: validation.error
                    });
                    return;
                }
                
                const reader = new FileReader();
                
                reader.onload = (event) => {
                    try {
                        const result = event.target.result;
                        
                        log('ØªÙ… Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù Ø¨Ù†Ø¬Ø§Ø­', 'success');
                        log(`Ø­Ø¬Ù… Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª: ${(result.length / 1024).toFixed(2)} KB`, 'info');
                        
                        // Ø¹Ø±Ø¶ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø©
                        const preview = document.createElement('img');
                        preview.src = result;
                        preview.className = 'preview-image';
                        preview.alt = 'Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø±ÙÙˆØ¹Ø©';
                        
                        const resultDiv = document.getElementById('result');
                        resultDiv.appendChild(preview);
                        
                        resolve({
                            success: true,
                            data: {
                                base64: result,
                                fileName: file.name,
                                fileSize: file.size,
                                fileType: file.type
                            }
                        });
                    } catch (error) {
                        log(`Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù: ${error.message}`, 'error');
                        resolve({
                            success: false,
                            error: 'Ø®Ø·Ø£ ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù'
                        });
                    }
                };
                
                reader.onerror = () => {
                    log('ÙØ´Ù„ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù', 'error');
                    resolve({
                        success: false,
                        error: 'ÙØ´Ù„ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù'
                    });
                };
                
                reader.readAsDataURL(file);
            });
        }
        
        // ÙˆØ¸ÙŠÙØ© Ø§Ø®ØªØ¨Ø§Ø± Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª
        async function testFileUpload(logoType = 'main') {
            try {
                log(`=== Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø±ÙØ¹ ${logoType} ===`, 'info');
                
                // Ø®ÙŠØ§Ø±Ø§Øª Ù…Ø®ØªÙ„ÙØ© Ø­Ø³Ø¨ Ù†ÙˆØ¹ Ø§Ù„Ø´Ø¹Ø§Ø±
                const uploadOptions = {
                    'main': {
                        maxSizeBytes: 2 * 1024 * 1024,
                        allowedTypes: ['image/jpeg', 'image/png', 'image/webp', 'image/svg+xml'],
                        maxWidth: 500,
                        maxHeight: 200
                    },
                    'icon': {
                        maxSizeBytes: 1 * 1024 * 1024,
                        allowedTypes: ['image/jpeg', 'image/png', 'image/webp', 'image/svg+xml'],
                        maxWidth: 128,
                        maxHeight: 128
                    },
                    'watermark': {
                        maxSizeBytes: 1 * 1024 * 1024,
                        allowedTypes: ['image/png', 'image/svg+xml'],
                        maxWidth: 300,
                        maxHeight: 300
                    }
                };
                
                const options = uploadOptions[logoType] || uploadOptions.main;
                log(`Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø±ÙØ¹: ${JSON.stringify(options)}`, 'info');
                
                // Ø¥Ù†Ø´Ø§Ø¡ file input
                const file = await createFileInput(options);
                
                if (!file) {
                    showResult('Ù„Ù… ÙŠØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Ø£Ùˆ ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø¹Ù…Ù„ÙŠØ©', false);
                    log('Ø§Ù†ØªÙ‡Ù‰ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ø¯ÙˆÙ† Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù', 'info');
                    return;
                }
                
                // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù
                const result = await processFileUpload(file, options);
                
                if (result.success) {
                    showResult(`âœ… ØªÙ… Ø±ÙØ¹ ${logoType} Ø¨Ù†Ø¬Ø§Ø­!<br>Ø§Ù„Ø§Ø³Ù…: ${result.data.fileName}<br>Ø§Ù„Ø­Ø¬Ù…: ${(result.data.fileSize / 1024).toFixed(2)} KB<br>Ø§Ù„Ù†ÙˆØ¹: ${result.data.fileType}`, true);
                    log(`=== Ø§ÙƒØªÙ…Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­ ===`, 'success');
                } else {
                    showResult(`âŒ ÙØ´Ù„ ÙÙŠ Ø±ÙØ¹ ${logoType}: ${result.error}`, false);
                    log(`=== ÙØ´Ù„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ${result.error} ===`, 'error');
                }
                
            } catch (error) {
                log(`Ø®Ø·Ø£ Ø¹Ø§Ù… ÙÙŠ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±: ${error.message}`, 'error');
                showResult(`âŒ Ø®Ø·Ø£ Ø¹Ø§Ù…: ${error.message}`, false);
            }
        }
        
        // Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø« Ø¨Ø§Ù„Ø£Ø²Ø±Ø§Ø±
        document.getElementById('testBasicUpload').addEventListener('click', () => {
            testFileUpload('basic');
        });
        
        document.getElementById('testMainLogo').addEventListener('click', () => {
            testFileUpload('main');
        });
        
        document.getElementById('testIconLogo').addEventListener('click', () => {
            testFileUpload('icon');
        });
        
        document.getElementById('testWatermarkLogo').addEventListener('click', () => {
            testFileUpload('watermark');
        });
        
        // Ø±Ø³Ø§Ù„Ø© ØªØ±Ø­ÙŠØ¨
        log('ğŸš€ ØªÙ… ØªØ­Ù…ÙŠÙ„ ØµÙØ­Ø© Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø± Ø¨Ù†Ø¬Ø§Ø­', 'success');
        log('Ø§Ù†Ù‚Ø± Ø¹Ù„Ù‰ Ø£ÙŠ Ù…Ù† Ø§Ù„Ø£Ø²Ø±Ø§Ø± Ø£Ø¹Ù„Ø§Ù‡ Ù„Ø¨Ø¯Ø¡ Ø§Ø®ØªØ¨Ø§Ø± Ø±ÙØ¹ Ø§Ù„Ù…Ù„ÙØ§Øª', 'info');
    </script>
</body>
</html>