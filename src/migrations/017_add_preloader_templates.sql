-- =================================================\n-- Ø¥Ø¶Ø§ÙØ© Ø¯Ø¹Ù… Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ù„Ù€ Preloader\n-- Advanced Preloader Templates Support Migration\n-- =================================================\n\n-- Ø¥Ø¶Ø§ÙØ© Ø­Ù‚Ù„ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù†Ø´Ø·\nALTER TABLE site_settings \nADD COLUMN IF NOT EXISTS preloader_active_template TEXT DEFAULT 'modern' \nCHECK (preloader_active_template IN (\n  'modern', 'glassy', 'professional', 'transparent', \n  'neon', 'elegant', 'futuristic'\n));\n\n-- ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ù„Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù†Ø´Ø·\nUPDATE site_settings \nSET \n    preloader_active_template = COALESCE(preloader_active_template, 'modern'),\n    updated_at = CURRENT_TIMESTAMP\nWHERE id = 1;\n\n-- Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ‚ Ù„Ù„Ø­Ù‚Ù„ Ø§Ù„Ø¬Ø¯ÙŠØ¯\nCOMMENT ON COLUMN site_settings.preloader_active_template IS 'Ù…Ø¹Ø±Ù Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù†Ø´Ø· Ù„Ù„Ù€ Preloader Ù…Ù† Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©';\n\n-- Ø¥Ù†Ø´Ø§Ø¡ ÙÙ‡Ø±Ø³ Ù„Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù†Ø´Ø·\nCREATE INDEX IF NOT EXISTS idx_site_settings_active_template ON site_settings(preloader_active_template);\n\n-- Ø¥Ù†Ø´Ø§Ø¡ Ø¯Ø§Ù„Ø© Ù„Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù†Ù…Ø§Ø°Ø¬\nCREATE OR REPLACE FUNCTION validate_preloader_template()\nRETURNS TRIGGER AS $$\nBEGIN\n    -- Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬\n    IF NEW.preloader_active_template IS NOT NULL AND \n       NEW.preloader_active_template NOT IN (\n           'modern', 'glassy', 'professional', 'transparent', \n           'neon', 'elegant', 'futuristic'\n       ) THEN\n        RAISE EXCEPTION 'Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø­Ø¯Ø¯ ØºÙŠØ± ØµØ­ÙŠØ­. Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…ØªØ§Ø­Ø©: modern, glassy, professional, transparent, neon, elegant, futuristic';\n    END IF;\n    \n    RETURN NEW;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- Ø±Ø¨Ø· Ø§Ù„Ø¯Ø§Ù„Ø© Ø¨Ù€ trigger\nDROP TRIGGER IF EXISTS validate_preloader_template_trigger ON site_settings;\nCREATE TRIGGER validate_preloader_template_trigger\n    BEFORE INSERT OR UPDATE ON site_settings\n    FOR EACH ROW\n    EXECUTE FUNCTION validate_preloader_template();\n\n-- Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ Ø¥Ø°Ø§ Ù„Ù… ÙŠÙˆØ¬Ø¯ ØµÙ ÙÙŠ Ø§Ù„Ø¬Ø¯ÙˆÙ„\nINSERT INTO site_settings (\n    id, site_title, site_description, logo_path, icon_path, favicon_path, loading_icon_path,\n    primary_color, secondary_color, meta_keywords, meta_author, \n    company_phone, company_email, company_address, company_website, company_currency,\n    system_language, rtl_support,\n    -- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Preloader Ù…Ø¹ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù†Ø´Ø·\n    preloader_enabled, preloader_logo_size, preloader_show_logo, preloader_logo_animation,\n    preloader_loading_message, preloader_show_app_name, preloader_custom_subtitle,\n    preloader_animation_type, preloader_animation_speed, preloader_animation_color,\n    preloader_background_color, preloader_text_color, preloader_blur_background,\n    preloader_show_progress, preloader_min_display_time, preloader_fade_out_duration,\n    preloader_active_template\n) \nSELECT \n    1, 'EP Group System', 'Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ù…ØªØ·ÙˆØ± Ù„Ù„Ø´Ø±ÙƒØ§Øª ÙˆØ§Ù„Ù…Ø¤Ø³Ø³Ø§Øª', \n    '/logo.svg', '/logo.png', '/favicon.ico', '/logo.svg',\n    '#0066cc', '#6c757d', 'EP Group, Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø©, Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø¹ÙŠØ§Ø¯Ø§Øª, Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ù…Ø³ØªÙˆØ¯Ø¹Ø§Øª', 'EP Group',\n    '+966123456789', 'info@epgroup.com', 'Ø§Ù„Ø±ÙŠØ§Ø¶ØŒ Ø§Ù„Ù…Ù…Ù„ÙƒØ© Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ø³Ø¹ÙˆØ¯ÙŠØ©', 'https://www.epgroup.com', '',\n    'ar', true,\n    -- Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Preloader Ù…Ø¹ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø¹ØµØ±ÙŠ ÙƒØ§ÙØªØ±Ø§Ø¶ÙŠ\n    true, 100, true, true,\n    'ğŸš€ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ± Ù„Ù„ØªØ¬Ø±Ø¨Ø©...', true, 'ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ù…ØªÙ‚Ø¯Ù…Ø© ÙÙŠ Ø®Ø¯Ù…ØªÙƒ',\n    'wave', 'normal', '#667eea',\n    '', '', true,\n    true, 1500, 500,\n    'modern' -- Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ\nWHERE NOT EXISTS (SELECT 1 FROM site_settings WHERE id = 1);\n\n-- Ø¯Ø§Ù„Ø© Ù…Ø³Ø§Ø¹Ø¯Ø© Ù„Ù„Ø­ØµÙˆÙ„ Ø¹Ù„Ù‰ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù†Ø´Ø·\nCREATE OR REPLACE FUNCTION get_active_preloader_template()\nRETURNS TEXT AS $$\nDECLARE\n    active_template TEXT;\nBEGIN\n    SELECT preloader_active_template INTO active_template\n    FROM site_settings\n    WHERE id = 1;\n    \n    RETURN COALESCE(active_template, 'modern');\nEND;\n$$ LANGUAGE plpgsql;\n\n-- Ø¯Ø§Ù„Ø© Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ù†Ù…ÙˆØ°Ø¬ Ù…Ø¹ÙŠÙ†\nCREATE OR REPLACE FUNCTION apply_preloader_template(template_id TEXT)\nRETURNS BOOLEAN AS $$\nBEGIN\n    -- Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ù†Ù…ÙˆØ°Ø¬\n    IF template_id NOT IN (\n        'modern', 'glassy', 'professional', 'transparent', \n        'neon', 'elegant', 'futuristic'\n    ) THEN\n        RAISE EXCEPTION 'Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø­Ø¯Ø¯ ØºÙŠØ± ØµØ­ÙŠØ­: %', template_id;\n    END IF;\n    \n    -- ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø­Ø³Ø¨ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬\n    CASE template_id\n        WHEN 'modern' THEN\n            UPDATE site_settings SET\n                preloader_active_template = 'modern',\n                preloader_logo_size = 100,\n                preloader_show_logo = true,\n                preloader_logo_animation = true,\n                preloader_loading_message = 'ğŸš€ Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ø¶ÙŠØ± Ù„Ù„ØªØ¬Ø±Ø¨Ø©...',\n                preloader_show_app_name = true,\n                preloader_custom_subtitle = 'ØªÙƒÙ†ÙˆÙ„ÙˆØ¬ÙŠØ§ Ù…ØªÙ‚Ø¯Ù…Ø© ÙÙŠ Ø®Ø¯Ù…ØªÙƒ',\n                preloader_animation_type = 'wave',\n                preloader_animation_speed = 'normal',\n                preloader_animation_color = '#667eea',\n                preloader_background_color = '',\n                preloader_text_color = '',\n                preloader_blur_background = true,\n                preloader_show_progress = true,\n                preloader_min_display_time = 1500,\n                preloader_fade_out_duration = 500,\n                updated_at = CURRENT_TIMESTAMP\n            WHERE id = 1;\n            \n        WHEN 'glassy' THEN\n            UPDATE site_settings SET\n                preloader_active_template = 'glassy',\n                preloader_logo_size = 120,\n                preloader_loading_message = 'âœ¨ Ø¬Ø§Ø±ÙŠ ØªØ¬Ù‡ÙŠØ² Ø§Ù„ØªØ¬Ø±Ø¨Ø© Ø§Ù„Ø±Ø§Ø¦Ø¹Ø©...',\n                preloader_custom_subtitle = 'Ø´ÙØ§ÙÙŠØ© ØªÙƒØ´Ù Ø§Ù„Ø¬Ù…Ø§Ù„',\n                preloader_animation_type = 'pulse',\n                preloader_animation_speed = 'slow',\n                preloader_animation_color = '#ffffff',\n                preloader_background_color = 'rgba(255, 255, 255, 0.05)',\n                preloader_text_color = '#ffffff',\n                preloader_blur_background = true,\n                preloader_show_progress = false,\n                preloader_min_display_time = 2000,\n                preloader_fade_out_duration = 800,\n                updated_at = CURRENT_TIMESTAMP\n            WHERE id = 1;\n            \n        WHEN 'professional' THEN\n            UPDATE site_settings SET\n                preloader_active_template = 'professional',\n                preloader_logo_size = 90,\n                preloader_logo_animation = false,\n                preloader_loading_message = 'Ø¬Ø§Ø±ÙŠ ØªØ­Ø¶ÙŠØ± Ø§Ù„Ù†Ø¸Ø§Ù…...',\n                preloader_custom_subtitle = 'Ø­Ù„ÙˆÙ„ Ù…Ù‡Ù†ÙŠØ© Ù…ØªÙ‚Ø¯Ù…Ø©',\n                preloader_animation_type = 'scale',\n                preloader_animation_speed = 'normal',\n                preloader_animation_color = '#2a5298',\n                preloader_background_color = '#ffffff',\n                preloader_text_color = '#1e3c72',\n                preloader_blur_background = false,\n                preloader_show_progress = true,\n                preloader_min_display_time = 1200,\n                preloader_fade_out_duration = 300,\n                updated_at = CURRENT_TIMESTAMP\n            WHERE id = 1;\n            \n        WHEN 'transparent' THEN\n            UPDATE site_settings SET\n                preloader_active_template = 'transparent',\n                preloader_logo_size = 80,\n                preloader_loading_message = 'Ø¬Ø§Ø±ÙŠ Ø§Ù„ØªØ­Ù…ÙŠÙ„ Ø¨Ù‡Ø¯ÙˆØ¡...',\n                preloader_show_app_name = false,\n                preloader_custom_subtitle = '',\n                preloader_animation_type = 'fade',\n                preloader_animation_speed = 'slow',\n                preloader_animation_color = 'rgba(0, 0, 0, 0.6)',\n                preloader_background_color = 'transparent',\n                preloader_text_color = 'rgba(0, 0, 0, 0.7)',\n                preloader_blur_background = false,\n                preloader_show_progress = false,\n                preloader_min_display_time = 800,\n                preloader_fade_out_duration = 1000,\n                updated_at = CURRENT_TIMESTAMP\n            WHERE id = 1;\n            \n        WHEN 'neon' THEN\n            UPDATE site_settings SET\n                preloader_active_template = 'neon',\n                preloader_logo_size = 110,\n                preloader_loading_message = 'âš¡ Ø´Ø­Ù† Ø§Ù„Ø·Ø§Ù‚Ø© Ø§Ù„Ø¥Ø¨Ø¯Ø§Ø¹ÙŠØ©...',\n                preloader_custom_subtitle = 'Ø§Ø³ØªØ¹Ø¯ Ù„Ù„Ø¥Ø¨Ù‡Ø§Ø±!',\n                preloader_animation_type = 'bounce',\n                preloader_animation_speed = 'fast',\n                preloader_animation_color = '#ff006e',\n                preloader_background_color = '#0a0a0a',\n                preloader_text_color = '#ffffff',\n                preloader_blur_background = false,\n                preloader_show_progress = true,\n                preloader_min_display_time = 2000,\n                preloader_fade_out_duration = 400,\n                updated_at = CURRENT_TIMESTAMP\n            WHERE id = 1;\n            \n        WHEN 'elegant' THEN\n            UPDATE site_settings SET\n                preloader_active_template = 'elegant',\n                preloader_logo_size = 70,\n                preloader_logo_animation = false,\n                preloader_loading_message = 'ØªØ­Ø¶ÙŠØ± Ø§Ù„Ù…Ø­ØªÙˆÙ‰...',\n                preloader_custom_subtitle = 'Ø¨Ø³Ø§Ø·Ø© ØªØªØ­Ø¯Ø« Ø¹Ù† Ù†ÙØ³Ù‡Ø§',\n                preloader_animation_type = 'dots',\n                preloader_animation_speed = 'normal',\n                preloader_animation_color = '#6c757d',\n                preloader_background_color = '#ffffff',\n                preloader_text_color = '#495057',\n                preloader_blur_background = false,\n                preloader_show_progress = false,\n                preloader_min_display_time = 1000,\n                preloader_fade_out_duration = 300,\n                updated_at = CURRENT_TIMESTAMP\n            WHERE id = 1;\n            \n        WHEN 'futuristic' THEN\n            UPDATE site_settings SET\n                preloader_active_template = 'futuristic',\n                preloader_logo_size = 130,\n                preloader_loading_message = 'ğŸ›¸ ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªÙ‚Ù†ÙŠØ§Øª Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø©...',\n                preloader_custom_subtitle = 'Ù…Ø±Ø­Ø¨Ø§Ù‹ Ø¨Ùƒ ÙÙŠ Ø§Ù„Ù…Ø³ØªÙ‚Ø¨Ù„',\n                preloader_animation_type = 'progress',\n                preloader_animation_speed = 'fast',\n                preloader_animation_color = '#00d4aa',\n                preloader_background_color = '#000814',\n                preloader_text_color = '#ffffff',\n                preloader_blur_background = true,\n                preloader_show_progress = true,\n                preloader_min_display_time = 1800,\n                preloader_fade_out_duration = 600,\n                updated_at = CURRENT_TIMESTAMP\n            WHERE id = 1;\n    END CASE;\n    \n    RETURN TRUE;\nEND;\n$$ LANGUAGE plpgsql;\n\n-- Ø¥Ù†Ø´Ø§Ø¡ Ø¬Ø¯ÙˆÙ„ Ù„Ø­ÙØ¸ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…Ø®ØµØµØ© (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)\nCREATE TABLE IF NOT EXISTS preloader_custom_templates (\n    id SERIAL PRIMARY KEY,\n    name TEXT NOT NULL,\n    description TEXT,\n    settings JSONB NOT NULL,\n    created_by INTEGER,\n    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,\n    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP\n);\n\n-- Ø¥Ø¶Ø§ÙØ© ØªØ¹Ù„ÙŠÙ‚Ø§Øª Ù„Ù„Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ø¬Ø¯ÙŠØ¯\nCOMMENT ON TABLE preloader_custom_templates IS 'Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…Ø®ØµØµØ© Ù„Ù„Ù€ Preloader';\nCOMMENT ON COLUMN preloader_custom_templates.settings IS 'Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¨ØµÙŠØºØ© JSON';\n\n-- Ø·Ø¨Ø§Ø¹Ø© Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­\nSELECT 'ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø¯Ø¹Ù… Ø§Ù„Ù†Ù…Ø§Ø°Ø¬ Ø§Ù„Ù…ØªÙ‚Ø¯Ù…Ø© Ù„Ù„Ù€ Preloader Ø¨Ù†Ø¬Ø§Ø­! ğŸ¨âœ¨' as result;"