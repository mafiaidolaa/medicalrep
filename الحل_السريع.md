# ๐ง ุญู ูุดููุฉ ุงุฎุชูุงุก ุงูุนูุงุฏุงุช - ุฏููู ุณุฑูุน

## ุงููุดููุฉ
ุงูุนูุงุฏุงุช ุงูุชู ูุถูููุง ุงููุณุชุฎุฏููู ุฐูู ุงูุตูุงุญูุงุช ุงููุญุฏูุฏุฉ (ูุซู "mo") ุชุฎุชูู ุจุนุฏ ุชุญุฏูุซ ุงูุตูุญุฉ ููุง ุชุธูุฑ ูุง ูููุณุชุฎุฏู ููุณู ููุง ููุฃุฏูู.

## โ ุงูุญู ุงูุณุฑูุน (5 ุฏูุงุฆู)

### ุงูุฎุทูุฉ 1๏ธโฃ: ุชุทุจูู ุฅุตูุงุญ ูุงุนุฏุฉ ุงูุจูุงูุงุช

1. ุงูุชุญ **Supabase Dashboard**
2. ุงุฐูุจ ุฅูู **SQL Editor**
3. ุงูุณุฎ ูุงูุตู ูุฐุง ุงูููุฏ **ุจุงููุงูู**:

```sql
-- ุชูุนูู RLS
ALTER TABLE clinics ENABLE ROW LEVEL SECURITY;

-- ุญุฐู ุงูุณูุงุณุงุช ุงููุฏููุฉ
DROP POLICY IF EXISTS "Service role has full access" ON clinics;
DROP POLICY IF EXISTS "Authenticated users can read all clinics" ON clinics;
DROP POLICY IF EXISTS "Authenticated users can insert clinics" ON clinics;
DROP POLICY IF EXISTS "Users can update their clinics or admins can update any" ON clinics;
DROP POLICY IF EXISTS "Only admins and managers can delete clinics" ON clinics;
DROP POLICY IF EXISTS "Enable read access for all users" ON clinics;
DROP POLICY IF EXISTS "Enable insert for authenticated users only" ON clinics;

-- ุฅูุดุงุก ุงูุณูุงุณุงุช ุงูุฌุฏูุฏุฉ
CREATE POLICY "Service role has full access" 
ON clinics FOR ALL TO service_role 
USING (true) WITH CHECK (true);

CREATE POLICY "Authenticated users can read all clinics" 
ON clinics FOR SELECT TO authenticated USING (true);

CREATE POLICY "Authenticated users can insert clinics" 
ON clinics FOR INSERT TO authenticated WITH CHECK (true);

CREATE POLICY "Users can update their clinics or admins can update any" 
ON clinics FOR UPDATE TO authenticated 
USING (true) WITH CHECK (true);

CREATE POLICY "Only admins and managers can delete clinics" 
ON clinics FOR DELETE TO authenticated 
USING (
    EXISTS (
        SELECT 1 FROM users 
        WHERE users.id = auth.uid()::text 
        AND users.role IN ('admin', 'manager')
    )
);
```

4. ุงุถุบุท **Run** ุฃู `Ctrl+Enter`
5. ูุฌุจ ุฃู ุชุฑู ุฑุณุงูุฉ ูุฌุงุญ: `Success. No rows returned`

### ุงูุฎุทูุฉ 2๏ธโฃ: ุฅุนุงุฏุฉ ุชุดุบูู ุงูุณูุฑูุฑ

ูู Terminal ุงูุฎุงุต ุจู:

```bash
# ุฃููู ุงูุณูุฑูุฑ ุจู Ctrl+C
# ุซู ุดุบูู ูุฑุฉ ุฃุฎุฑู
npm run dev
```

### ุงูุฎุทูุฉ 3๏ธโฃ: ูุณุญ ุงูู Cache ูุงุฎุชุจุงุฑ ุงูุญู

1. ุงูุชุญ ุงููุชุตูุญ ูุงุถุบุท `Ctrl + Shift + R` (Hard Refresh)
2. ุณุฌู ุฏุฎูู ุจุญุณุงุจ "mo"
3. ุฃุถู ุนูุงุฏุฉ ุฌุฏูุฏุฉ (ุชุฃูุฏ ูู ููุก ุงูููุทูุฉ ูุงูุฎุท)
4. ุญุฏุซ ุงูุตูุญุฉ `F5` ุฃู `Ctrl + R`
5. **ูุฌุจ ุฃู ุชุธูุฑ ุงูุนูุงุฏุฉ ุงูุขู!** โ

### ุงูุฎุทูุฉ 4๏ธโฃ: ุงูุชุญูู ูู ูุฌุงุญ ุงูุญู

ุงูุชุญ ูุฐุง ุงูุฑุงุจุท ูู ุงููุชุตูุญ (ูุฃูุช ูุณุฌู ุฏุฎูู):
```
http://localhost:3000/api/clinics/debug
```

ูุฌุจ ุฃู ุชุฑู:
- โ `serviceRoleKeyPresent: true`
- โ `serviceRoleClinicCount` ุฃูุจุฑ ูู 0
- โ ูุงุฆูุฉ ุจุงูุนูุงุฏุงุช ูู `latestClinics`

## ๐ ุงูุชุดุฎูุต ุงูุชูุตููู (ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ)

ุงุณุชุฎุฏู ุงูููู: `diagnose_clinics_fixed.sql`

ูู Supabase SQL Editorุ ูู ุจุชุดุบูู ุงูุฃูุงูุฑ ูุงุญุฏุงู ุชูู ุงูุขุฎุฑ ููุนุฑูุฉ:
- ุญุงูุฉ RLS
- ุงูุณูุงุณุงุช ุงูููุฌูุฏุฉ
- ุนุฏุฏ ุงูุนูุงุฏุงุช ุงูููู
- ุงูุนูุงุฏุงุช ุงูุชู ุจูุง ูุดุงูู

## ๐ฏ ุงููุชูุฌุฉ ุงููุชููุนุฉ ุจุนุฏ ุงูุฅุตูุงุญ

- โ ุงููุณุชุฎุฏู "mo" ูุณุชุทูุน ุฅุถุงูุฉ ุนูุงุฏุงุช
- โ ุงููุณุชุฎุฏู "mo" ูุฑู ุงูุนูุงุฏุงุช ุงูุชู ุฃุถุงููุง ุจุนุฏ ุงูุชุญุฏูุซ
- โ ุงูุฃุฏูู ูุฑู ุฌููุน ุงูุนูุงุฏุงุช ุจูุง ูููุง ุนูุงุฏุงุช "mo"
- โ ุงููุณุชุฎุฏููู ุงูุนุงุฏููู ูุฑูู ููุท ุงูุนูุงุฏุงุช ูู ููุทูุชูู/ุฎุทูู
- โ ูุง ุชูุฌุฏ ุนูุงุฏุงุช "ูุฎุชููุฉ"

## โ๏ธ ููุงุญุธุงุช ูููุฉ

1. **ุจุนุฏ ุชุนุฏูู `.env.local`** ูุฌุจ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุณูุฑูุฑ
2. **ุงุณุชุฎุฏู Hard Refresh** ุฏุงุฆูุงู: `Ctrl + Shift + R`
3. **ุชุฃูุฏ ูู ููุก ุฌููุน ุงูุญููู ุงููุทููุจุฉ**: ุงูุงุณูุ ุงุณู ุงูุทุจูุจุ ุงูููุทูุฉุ ุงูุฎุท
4. **ุฅุฐุง ุธูุฑุช ูุดููุฉ**: ุชุญูู ูู console ุงููุชุตูุญ ู terminal ุงูุณูุฑูุฑ

## ๐ ุณุจุจ ุงููุดููุฉ

ูุงูุช ุงููุดููุฉ ูุชูุฌุฉ ูู:
1. **ุณูุงุณุงุช RLS ูููุฏุฉ ุฌุฏุงู** - ุชููุน ุงููุณุชุฎุฏููู ูู ุฑุคูุฉ ุงูุจูุงูุงุช
2. **ุงูู Cache** - ูุญูุธ ูุชุงุฆุฌ ูุงุฑุบุฉ ููุฏุฉ ุฏูููุชูู
3. **ุนููุฏ `status` ุบูุฑ ููุฌูุฏ** - ูุงู ูู ุงูููุฏ ุงููุฏูู ููุณุจุจ ุฃุฎุทุงุก SQL

## ๐ ูุง ูุฒุงู ูุง ูุนููุ

1. ุดุบู: `http://localhost:3000/api/clinics/debug`
2. ุดุบู: `diagnose_clinics_fixed.sql` ูู Supabase
3. ุชุญูู ูู Browser Console (F12) โ Console tab
4. ุชุญูู ูู Terminal ุญูุซ ูุนูู ุงูุณูุฑูุฑ
5. ุดุงุฑู ุงูุฃุฎุทุงุก ุงูุชู ุชุธูุฑ

## โจ ุชุญุณููุงุช ุชู ุฅุถุงูุชูุง

- โ ุฅุตูุงุญ ุณูุงุณุงุช RLS
- โ ุฅุฒุงูุฉ ุนููุฏ `status` ุบูุฑ ุงูููุฌูุฏ ูู ุงูุฃููุงุฏ
- โ ุฅุถุงูุฉ Cache Invalidation headers
- โ ุฅุถุงูุฉ endpoint ููุชุดุฎูุต: `/api/clinics/debug`
- โ ุชุญุณูู logging ูู API route
