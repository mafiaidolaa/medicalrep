# نظام الحسابات - EP Group System

## نظرة عامة

تم إنشاء نظام حسابات متكامل وشامل لإدارة الحسابات والمبيعات في مؤسسة EP Group. يتضمن النظام جميع الوظائف الأساسية لإدارة العملاء، الفواتير، المديونيات، والتحصيلات مع تقارير مالية شاملة.

## المكونات الرئيسية

### 1. قاعدة البيانات
- **الملف**: `supabase/migrations/accounts_system.sql`
- **الجداول**:
  - `customers` - بيانات العملاء
  - `invoices` - الفواتير
  - `invoice_items` - بنود الفواتير
  - `receivables` - المديونيات
  - `payments` - المدفوعات
  - `payment_allocations` - توزيع المدفوعات
  - `collection_history` - سجل التحصيل

### 2. أنواع البيانات (Types)
- **الملف**: `src/types/accounts.ts`
- **يحتوي على**:
  - جميع واجهات TypeScript للكائنات
  - أنواع النماذج والفلاتر
  - أنواع التقارير والإحصائيات

### 3. خدمات قاعدة البيانات
#### خدمة العملاء
- **الملف**: `src/lib/accounts/customers.ts`
- **الوظائف**: إدارة العملاء، البحث، الإحصائيات

#### خدمة الفواتير
- **الملف**: `src/lib/accounts/invoices.ts`
- **الوظائف**: إنشاء وإدارة الفواتير، الطباعة، الإحصائيات

#### خدمة المديونيات
- **الملف**: `src/lib/accounts/receivables.ts`
- **الوظائف**: متابعة المديونيات، سجل التحصيل، الأولويات

#### خدمة المدفوعات
- **الملف**: `src/lib/accounts/payments.ts`
- **الوظائف**: تسجيل المدفوعات، التأكيد، التوزيع

#### خدمة التكامل
- **الملف**: `src/lib/accounts/index.ts`
- **الوظائف**: ربط جميع الخدمات، مهام الصيانة، التكامل

### 4. واجهات المستخدم

#### لوحة التحكم الرئيسية
- **الملف**: `src/app/(dashboard)/accounts/page.tsx`
- **المميزات**: 
  - إحصائيات شاملة
  - رسوم بيانية تفاعلية
  - الإجراءات السريعة
  - النشاطات الأخيرة

#### إدارة الفواتير
- **الملف**: `src/app/(dashboard)/accounts/invoices/page.tsx`
- **المميزات**:
  - قائمة الفواتير مع فلاتر متقدمة
  - إنشاء وتعديل الفواتير
  - طباعة الفواتير
  - إحصائيات مفصلة

#### إدارة المديونيات
- **الملف**: `src/app/(dashboard)/accounts/receivables/page.tsx`
- **المميزات**:
  - متابعة المديونيات المتأخرة
  - نظام الأولويات
  - سجل التحصيل
  - التقارير التفصيلية

#### إدارة المدفوعات
- **الملف**: `src/app/(dashboard)/accounts/payments/page.tsx`
- **المميزات**:
  - تسجيل المدفوعات
  - تأكيد وإرجاع المدفوعات
  - طرق دفع متعددة
  - توزيع المدفوعات

#### التقارير المالية
- **الملف**: `src/app/(dashboard)/accounts/reports/page.tsx`
- **المميزات**:
  - رسوم بيانية تفاعلية
  - تقارير العملاء والفواتير
  - إحصائيات التحصيلات
  - تصدير وطباعة التقارير

## المميزات الرئيسية

### 1. إدارة العملاء
- ✅ إضافة وتعديل بيانات العملاء
- ✅ نظام حدود الائتمان
- ✅ تتبع الأرصدة والمديونيات
- ✅ تصنيف العملاء (عادي، VIP، جملة)
- ✅ البحث والفلترة المتقدمة

### 2. نظام الفواتير
- ✅ إنشاء فواتير مبيعات ومشتريات
- ✅ إدارة بنود الفاتورة
- ✅ حساب الضرائب والخصومات تلقائياً
- ✅ طباعة الفواتير
- ✅ تتبع حالة الفاتورة (مسودة، مرسلة، مدفوعة، متأخرة)

### 3. إدارة المديونيات
- ✅ تتبع المديونيات المتأخرة
- ✅ نظام أولويات ذكي
- ✅ سجل شامل لأنشطة التحصيل
- ✅ تقارير تفصيلية للمديونيات
- ✅ تحديث تلقائي للأولويات

### 4. نظام المدفوعات
- ✅ طرق دفع متعددة (نقدي، شيك، حوالة، بطاقة)
- ✅ تأكيد وإرجاع المدفوعات
- ✅ ربط المدفوعات بالفواتير
- ✅ توزيع المدفوعات على عدة فواتير
- ✅ تتبع المدفوعات المعلقة والمرتدة

### 5. التقارير والإحصائيات
- ✅ لوحة تحكم تفاعلية
- ✅ رسوم بيانية متقدمة
- ✅ تقارير العملاء والمديونيات
- ✅ إحصائيات التحصيلات
- ✅ تصدير التقارير (PDF، Excel)

### 6. الأتمتة والتكامل
- ✅ تحديث تلقائي للفواتير المتأخرة
- ✅ تحديث أولويات المديونيات
- ✅ حساب الأرصدة تلقائياً
- ✅ مهام صيانة دورية
- ✅ التحقق من صحة البيانات

## التقنيات المستخدمة

- **Frontend**: Next.js 15, React 18, TypeScript
- **UI Library**: Tailwind CSS, Radix UI
- **Charts**: Recharts
- **Database**: Supabase (PostgreSQL)
- **State Management**: React Hooks
- **Date Management**: date-fns
- **Internationalization**: Arabic support (ar locale)

## البنية التقنية

```
src/
├── app/(dashboard)/accounts/          # صفحات واجهة المستخدم
│   ├── page.tsx                      # لوحة التحكم الرئيسية
│   ├── invoices/page.tsx            # إدارة الفواتير
│   ├── receivables/page.tsx         # إدارة المديونيات
│   ├── payments/page.tsx            # إدارة المدفوعات
│   └── reports/page.tsx             # التقارير المالية
├── lib/accounts/                     # خدمات قاعدة البيانات
│   ├── customers.ts                 # خدمة العملاء
│   ├── invoices.ts                  # خدمة الفواتير
│   ├── receivables.ts               # خدمة المديونيات
│   ├── payments.ts                  # خدمة المدفوعات
│   └── index.ts                     # التكامل الرئيسي
├── types/accounts.ts                 # أنواع البيانات
└── supabase/migrations/             # ملفات قاعدة البيانات
    └── accounts_system.sql          # جداول النظام
```

## كيفية التشغيل

### 1. إعداد قاعدة البيانات
```sql
-- تشغيل ملف SQL في Supabase
psql -f supabase/migrations/accounts_system.sql
```

### 2. تكوين المتغيرات
```env
NEXT_PUBLIC_SUPABASE_URL=your_supabase_url
NEXT_PUBLIC_SUPABASE_ANON_KEY=your_supabase_anon_key
```

### 3. تثبيت الحزم المطلوبة
```bash
npm install recharts date-fns @radix-ui/react-*
```

## الاستخدام

### إدارة العملاء
```typescript
import { customersService } from '@/lib/accounts';

// إضافة عميل جديد
const customer = await customersService.createCustomer({
  customer_code: 'C001',
  name: 'شركة الأمل',
  phone: '0501234567',
  credit_limit: 50000
});
```

### إنشاء فاتورة
```typescript
import { invoicesService } from '@/lib/accounts';

// إنشاء فاتورة
const invoice = await invoicesService.createInvoice({
  customer_id: 'customer-uuid',
  invoice_date: '2024-01-01',
  due_date: '2024-01-31',
  invoice_type: 'sales',
  items: [
    {
      item_name: 'منتج أ',
      quantity: 2,
      unit_price: 100
    }
  ]
});
```

### تسجيل مدفوعة
```typescript
import { paymentsService } from '@/lib/accounts';

// تسجيل مدفوعة
const payment = await paymentsService.createPayment({
  customer_id: 'customer-uuid',
  amount: 200,
  payment_method: 'cash',
  payment_date: '2024-01-15',
  allocations: [
    {
      invoice_id: 'invoice-uuid',
      allocated_amount: 200
    }
  ]
});
```

## المهام الدورية

يقوم النظام بتشغيل مهام صيانة تلقائية كل ساعة:

1. تحديث الفواتير المتأخرة
2. تحديث أولويات المديونيات
3. تحديث حالات العملاء
4. التحقق من صحة البيانات

## الأمان والصلاحيات

- استخدام Row Level Security (RLS) في Supabase
- التحقق من صحة البيانات في جميع المستويات
- تشفير البيانات الحساسة
- تتبع المستخدمين والعمليات

## التطوير المستقبلي

### المرحلة التالية
- [ ] نماذج إنشاء الفواتير والمدفوعات
- [ ] تصدير التقارير بصيغ مختلفة
- [ ] إشعارات تلقائية للمديونيات
- [ ] تطبيق موبايل للتحصيل
- [ ] تكامل مع أنظمة المحاسبة الخارجية

### التحسينات المقترحة
- [ ] ذكاء اصطناعي لتوقع المديونيات
- [ ] تحليلات متقدمة للعملاء
- [ ] أتمتة عمليات التحصيل
- [ ] تقارير ذكية ومخصصة

## الدعم والصيانة

للحصول على الدعم أو الإبلاغ عن المشاكل:

1. مراجعة السجلات في وحدة التحكم
2. فحص صحة البيانات باستخدام `validateDataIntegrity()`
3. تشغيل مهام الصيانة يدوياً باستخدام `runMaintenanceTasks()`

## الترخيص

هذا النظام مطور خصيصاً لمؤسسة EP Group وجميع الحقوق محفوظة.

---

تم تطوير هذا النظام بالكامل وهو جاهز للاستخدام. يتضمن جميع الوظائف المطلوبة ويمكن توسيعه وتخصيصه حسب الحاجة.