# ๐ง ุฅุตูุงุญ ูุดููุฉ ุญุฐู ุงููุณุชุฎุฏููู

## ๐ ุงููุดููุฉ
ุนูุฏ ูุญุงููุฉ ุญุฐู ูุณุชุฎุฏููู ุชุฌุฑูุจูููุ ูุธูุฑ ุงูุฎุทุฃ ุงูุชุงูู:
```
Error deleting from users: TypeError: NetworkError when attempting to fetch resource.
```

## ๐ ุงูุณุจุจ
ุงูุณุจุจ ุงูุฑุฆูุณู ูููุดููุฉ ูู ุฃุญุฏ ุงูุฃููุฑ ุงูุชุงููุฉ:
1. **ุณูุงุณุงุช Row Level Security (RLS)** ูู Supabase ูุง ุชุณูุญ ุจุญุฐู ุงููุณุชุฎุฏููู
2. ุงุณุชุฎุฏุงู **Anon Key** ุจุฏูุงู ูู **Service Role Key** ูุนูููุงุช ุงูุญุฐู
3. ูุดุงูู ูู ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช ุฃู ุฌุฏุงุฑ ุญูุงูุฉ

## โ ุงูุญููู ุงููุทุจูุฉ

### ุงูุญู 1: ุงุณุชุฎุฏุงู API Route ูุน Service Role Key โญ (ููุทุจูู)

ุชู ุฅูุดุงุก API route ุฌุฏูุฏ ูู:
- `src/app/api/users/[id]/route.ts`

ูุฐุง ุงูุญู ูุณุชุฎุฏู `Service Role Key` ุนูู ุฌุงูุจ ุงูุฎุงุฏู ูุชุฌุงูุฒ ุณูุงุณุงุช RLS.

**ุงููููุฒุงุช:**
- โ ูุชุฌุงูุฒ ุณูุงุณุงุช RLS ุจุดูู ุขูู
- โ ูุญุงูุธ ุนูู ุงูุฃูุงู ุจุงูุชุญูู ูู ุงูุตูุงุญูุงุช
- โ ูุง ูุญุชุงุฌ ุชุนุฏูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

ุชู ุชุนุฏูู ูุธููุฉ `deleteUser` ูู `src/lib/supabase-services.ts` ูุงุณุชุฎุฏุงู API route ุฃููุงู.

### ุงูุญู 2: ุชุญุฏูุซ ุณูุงุณุงุช RLS (ุงุฎุชูุงุฑู)

ุฅุฐุง ููุช ุชูุถู ุงูุณูุงุญ ุจุงูุญุฐู ูุจุงุดุฑุฉ ูู ุฌุงูุจ ุงูุนูููุ ุงุณุชุฎุฏู ููู SQL:
- `fix-users-rls-policies.sql`

**ุฎุทูุงุช ุงูุชุทุจูู:**
1. ุงูุชุญ ููุญุฉ ุชุญูู Supabase: https://supabase.com/dashboard
2. ุงุฐูุจ ุฅูู **SQL Editor**
3. ุงูุณุฎ ูุญุชููุงุช ููู `fix-users-rls-policies.sql`
4. ุงูุตู ุงูููุฏ ูุงููุฑ ุนูู **Run**

## ๐ ุงูุชุฌุฑุจุฉ

### ุงูุฎุทูุฉ 1: ุฅุนุงุฏุฉ ุชุดุบูู ุงูุฎุงุฏู
```bash
# ุฃููู ุงูุฎุงุฏู ุงูุญุงูู (Ctrl+C) ุซู ุดุบูู ูู ุฌุฏูุฏ
npm run dev
```

### ุงูุฎุทูุฉ 2: ุงุฎุชุจุงุฑ ุงูุญุฐู
1. ุงูุชุญ ุตูุญุฉ ุงููุณุชุฎุฏููู
2. ุญุงูู ุญุฐู ูุณุชุฎุฏู ุชุฌุฑูุจู
3. ูุฌุจ ุฃู ูุนูู ุงูุญุฐู ุจูุฌุงุญ ุงูุขู

## ๐ ุงูุชุญูู ูู ุงูุตูุงุญูุงุช

API route ุงูุฌุฏูุฏ ูุชุญูู ูู:
- โ ุงููุณุชุฎุฏู ูุณุฌู ุฏุฎูู
- โ ุงููุณุชุฎุฏู ูุฏูู ุฏูุฑ `admin` ุฃู `manager`
- โ ุงูุทูุจ ุตุงูุญ

## ๐ ููุงุญุธุงุช ูููุฉ

1. **Service Role Key ููุฌูุฏ ูู `.env.local`**:
   ```
   SUPABASE_SERVICE_ROLE_KEY="..."
   ```

2. **API route ูุนูู ุนูู ุฌุงูุจ ุงูุฎุงุฏู ููุท**ุ ููุง ูุญุงูุธ ุนูู ุฃูุงู ุงูู Service Role Key

3. **Fallback**: ุฅุฐุง ูุดู API routeุ ุณูุญุงูู ุงููุธุงู ุงุณุชุฎุฏุงู ุงูุงุชุตุงู ุงููุจุงุดุฑ ุจู Supabase

## ๐๏ธ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ:

#### 1. ุชุญูู ูู Service Role Key
```bash
# ุชุฃูุฏ ูู ูุฌูุฏ ุงูููุชุงุญ ูู .env.local
cat .env.local | grep SUPABASE_SERVICE_ROLE_KEY
```

#### 2. ุชุญูู ูู ุงูุงุชุตุงู ุจุงูุฅูุชุฑูุช
```bash
# ุงุฎุชุจุฑ ุงูุงุชุตุงู ุจู Supabase
curl https://vxdvcrcbegggilreaoip.supabase.co
```

#### 3. ุงูุญุต Console ุงูุฎุงุต ุจุงููุชุตูุญ
- ุงูุชุญ Developer Tools (F12)
- ุงุฐูุจ ุฅูู **Network** tab
- ุญุงูู ุงูุญุฐู ูุฑุฉ ุฃุฎุฑู
- ุงุจุญุซ ุนู ุทูุจ `/api/users/[id]` ูุงูุญุต ุงูุงุณุชุฌุงุจุฉ

#### 4. ุงูุญุต Logs ูู Supabase Dashboard
- ุงุฐูุจ ุฅูู **Logs** -> **API Logs**
- ุงุจุญุซ ุนู ุทูุจุงุช DELETE ุนูู ุฌุฏูู users
- ุงูุญุต ุงูุฃุฎุทุงุก ุฅู ูุฌุฏุช

## ๐ ุงูุฏุนู

ุฅุฐุง ุงุณุชูุฑุช ุงููุดููุฉ ุจุนุฏ ุชุทุจูู ุฌููุน ุงูุญููู:
1. ุชุญูู ูู ุฃู ุงูุฎุงุฏู ุชู ุฅุนุงุฏุฉ ุชุดุบููู
2. ุงูุณุญ cache ุงููุชุตูุญ
3. ุชุญูู ูู ุณูุงุณุงุช RLS ูู Supabase Dashboard

---

**ุขุฎุฑ ุชุญุฏูุซ:** 2025-09-29
**ุงูุญุงูุฉ:** โ ุชู ุชุทุจูู ุงูุฅุตูุงุญ