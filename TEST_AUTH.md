# ๐งช ุฏููู ุงุฎุชุจุงุฑ ูุธุงู ุงููุตุงุฏูุฉ

## ุงุฎุชุจุงุฑ ุณุฑูุน (Quick Test)

### โ ุงูุงุฎุชุจุงุฑ 1: ุงููุตูู ุจุฏูู ุชุณุฌูู ุฏุฎูู
```bash
ุงูุฎุทูุงุช:
1. ุงูุชุญ ูุชุตูุญ ุฌุฏูุฏ (ุฃู Incognito/Private)
2. ุงุฐูุจ ุฅูู: http://localhost:3000
3. ุงููุชูุฌุฉ ุงููุชููุนุฉ: ูุชู ุชูุฌููู ุชููุงุฆูุงู ุฅูู /login

โ ุฅุฐุง ุชู ุงูุชูุฌูู = ุงููุธุงู ุขูู
โ ุฅุฐุง ูุชุญุช Dashboard = ููุงู ูุดููุฉ
```

### โ ุงูุงุฎุชุจุงุฑ 2: ูุณุญ ุงููุงุด ูุงูุฌูุณุงุช
```bash
ุงูุฎุทูุงุช:
1. ุณุฌู ุฏุฎูู ุนุงุฏู ุฅูู ุงููุธุงู
2. ุงุถุบุท F12 (ูุชุญ Developer Tools)
3. ุงุฐูุจ ุฅูู ุชุจููุจ "Application"
4. ูู ุงููุงุฆูุฉ ุงูุฌุงูุจูุฉ:
   - ุงููุฑ "Clear site data"
   - ุฃู ุงูุณุญ Cookies ู Local Storage ูุฏููุงู
5. ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ (F5)
6. ุงููุชูุฌุฉ ุงููุชููุนุฉ: ูุชู ุชูุฌููู ุฅูู /login

โ ุฅุฐุง ุชู ุงูุชูุฌูู = ุงููุธุงู ุขูู
โ ุฅุฐุง ุจููุช ูู Dashboard = ููุงู ูุดููุฉ
```

### โ ุงูุงุฎุชุจุงุฑ 3: ุงูุชุญูู ูู Middleware
```bash
ุงูุฎุทูุงุช:
1. ุงูุชุญ ูุชุตูุญ Incognito
2. ุงุฐูุจ ุฅูู: http://localhost:3000/users
3. ุฃู ุฃู ุตูุญุฉ ุฃุฎุฑู ูุซู: /clinics, /orders, etc.
4. ุงููุชูุฌุฉ ุงููุชููุนุฉ: ุชูุฌูู ุฅูู /login

โ ุฌููุน ุงูุตูุญุงุช ูุญููุฉ
โ ุฅุฐุง ูุชุญุช ุฃู ุตูุญุฉ ุจุฏูู login = ูุดููุฉ
```

---

## ุงุฎุชุจุงุฑุงุช ูุชูุฏูุฉ

### ๐ ุงูุงุฎุชุจุงุฑ 4: Session Validation API

ุงูุชุญ Console ูู ุงููุชุตูุญ ููู ุจุชุดุบูู:

```javascript
// ุงูุงุฎุชุจุงุฑ 1: ุจุฏูู ุชุณุฌูู ุฏุฎูู
fetch('/api/auth/validate')
  .then(r => r.json())
  .then(console.log)

// ุงููุชูุฌุฉ ุงููุชููุนุฉ:
// { valid: false, error: "No session found", code: "NO_SESSION" }


// ุงูุงุฎุชุจุงุฑ 2: ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู
fetch('/api/auth/validate')
  .then(r => r.json())
  .then(console.log)

// ุงููุชูุฌุฉ ุงููุชููุนุฉ:
// {
//   valid: true,
//   user: { id: "...", username: "...", role: "..." },
//   expiresAt: 1234567890
// }
```

### ๐ ุงูุงุฎุชุจุงุฑ 5: Session Versioning

```bash
ุงูุฎุทูุงุช:
1. ุณุฌู ุฏุฎูู ุฅูู ุงููุธุงู
2. ุงูุชุญ .env.local
3. ุบููุฑ: DEV_COOKIE_VERSION="3" (ุฃู ุฑูู ุฌุฏูุฏ)
4. ุฃุนุฏ ุชุดุบูู ุงูุฎุงุฏู (Ctrl+C ุซู npm run dev)
5. ุฃุนุฏ ุชุญููู ุงูุตูุญุฉ ูู ุงููุชุตูุญ (F5)
6. ุงููุชูุฌุฉ ุงููุชููุนุฉ: ุชูุฌูู ุฅูู /login

โ ุงูุฌูุณุงุช ุงููุฏููุฉ ุชู ุฅุจุทุงููุง
```

### ๐ ุงูุงุฎุชุจุงุฑ 6: Middleware Headers

ุงูุชุญ Network tab ูู Developer Tools:

```bash
ุงูุฎุทูุงุช:
1. ุณุฌู ุฏุฎูู
2. ุงูุชุญ Network tab
3. ุฃุนุฏ ุชุญููู ุฃู ุตูุญุฉ
4. ุงููุฑ ุนูู ุงูู Request
5. ูู Headersุ ุงุจุญุซ ุนู:
   - X-Frame-Options: DENY
   - X-Content-Type-Options: nosniff
   - X-User-Authenticated: true
   - X-User-Role: (ุฏูุฑู)

โ Headers ููุฌูุฏุฉ = ุงูุญูุงูุฉ ููุนูุฉ
```

---

## ุงุฎุชุจุงุฑุงุช ุฃูููุฉ

### ๐ก๏ธ ุงูุงุฎุชุจุงุฑ 7: ููุน ุงููุตูู ููู Login ุจุนุฏ ุชุณุฌูู ุงูุฏุฎูู

```bash
ุงูุฎุทูุงุช:
1. ุณุฌู ุฏุฎูู ุนุงุฏู
2. ุญุงูู ุงูุฐูุงุจ ูุฏููุงู ุฅูู: http://localhost:3000/login
3. ุงููุชูุฌุฉ ุงููุชููุนุฉ: ุชูุฌูู ุชููุงุฆู ุฅูู Dashboard (/)

โ ูุง ูููู ุงููุตูู ูู /login ุฅุฐุง ููุช ูุณุฌู ุฏุฎูู
```

### ๐ก๏ธ ุงูุงุฎุชุจุงุฑ 8: ูุญุงููุงุช ุงููุตูู ุงููุชูุฑุฑุฉ

ุงูุชุญ Console ูุฑุงูุจ ุงูู Logs:

```bash
ุงูุฎุทูุงุช:
1. ุงูุชุญ ูุชุตูุญ Incognito
2. ุงูุชุญ Console (F12)
3. ุญุงูู ุงููุตูู ูุนุฏุฉ ุตูุญุงุช ูุญููุฉ
4. ุฑุงูุจ ุงูู Console ููุฑุณุงุฆู:
   ๐ซ Unauthorized access attempt to: /path
   โ๏ธ Multiple failed authentication attempts detected

โ ุงููุธุงู ูุชุชุจุน ุงููุญุงููุงุช ุงููุงุดูุฉ
```

---

## ุงุฎุชุจุงุฑุงุช ุงูุฃุฏุงุก

### โก ุงูุงุฎุชุจุงุฑ 9: Session Caching

```bash
ุงูุฎุทูุงุช:
1. ุณุฌู ุฏุฎูู
2. ุงูุชุญ Network tab
3. ุชุตูุญ ุจูู ุงูุตูุญุงุช ุงููุฎุชููุฉ
4. ูุงุญุธ ุนุฏุฏ ุงูุทูุจุงุช ูู /api/auth/session
5. ุงููุชูุฌุฉ ุงููุชููุนุฉ: ุทูุจ ูุงุญุฏ ููุท ูู 5 ุฏูุงุฆู

โ Caching ูุนูู ุจุดูู ุตุญูุญ
```

### โก ุงูุงุฎุชุจุงุฑ 10: Background Activity Logging

```bash
ุงูุฎุทูุงุช:
1. ุณุฌู ุฏุฎูู
2. ุชุตูุญ ุจูู ุงูุตูุญุงุช
3. ูุงุญุธ ุณุฑุนุฉ ุงูุชุตูุญ
4. ุงููุชูุฌุฉ ุงููุชููุนุฉ: ูุง ุชุฃุฎูุฑ ูู ุงูุชุญููู

โ Activity logging ูุง ูุนูู ุงูุฃุฏุงุก
```

---

## Console Logs ุงููุชููุนุฉ

### ุนูุฏ ุงููุตูู ุจุฏูู ุชุณุฌูู ุฏุฎูู:
```
๐ซ Unauthorized access attempt to: /dashboard
```

### ุนูุฏ ุชุณุฌูู ุงูุฏุฎูู:
```
โ Authenticated user redirected from login to dashboard
โ Login activity logged successfully
```

### ุนูุฏ session ุบูุฑ ุตุงูุญุฉ:
```
โ๏ธ Invalid user data in session
โ๏ธ Session validation failed - logging out
```

### ุนูุฏ ุชุญุฏูุซ Session Version:
```
โ๏ธ Session version mismatch - invalidating
```

---

## ุญุงูุงุช ุงุฎุชุจุงุฑ ุฅุถุงููุฉ

### ๐ ุงูุงุฎุชุจุงุฑ 11: ุชุณุฌูู ุงูุฎุฑูุฌ

```bash
ุงูุฎุทูุงุช:
1. ุณุฌู ุฏุฎูู
2. ุงููุฑ ุนูู ุฒุฑ ุชุณุฌูู ุงูุฎุฑูุฌ
3. ุงููุชูุฌุฉ ุงููุชููุนุฉ:
   - ุชูุฌูู ุฅูู /login
   - localStorage ูุญุชูู ุนูู logout_timestamp
   - ูุง ูููู ุงูุนูุฏุฉ ูููุธุงู ุจุฒุฑ Back

โ ุชุณุฌูู ุฎุฑูุฌ ุขูู
```

### ๐ ุงูุงุฎุชุจุงุฑ 12: ูุญุงููุฉ ุชุณุฌูู ุฏุฎูู ุฎุงุทุฆ

```bash
ุงูุฎุทูุงุช:
1. ุฃุฏุฎู username ุตุญูุญ + password ุฎุงุทุฆ
2. ุงููุชูุฌุฉ ุงููุชููุนุฉ:
   - ุฑุณุงูุฉ ุฎุทุฃ: "Invalid credentials"
   - ุงูุจูุงุก ูู ุตูุญุฉ Login
   - ุนุฏู ุฅูุดุงุก ุฃู session

โ ุฑูุถ ุงูุฏุฎูู ุบูุฑ ุงูุตุญูุญ
```

### ๐ ุงูุงุฎุชุจุงุฑ 13: ุตูุงุญูุงุช ุงููุณุชุฎุฏููู

```bash
ุงูุฎุทูุงุช:
1. ุณุฌู ุฏุฎูู ููุณุชุฎุฏู ุนุงุฏู (Rep)
2. ุญุงูู ุงููุตูู ุฅูู: /users ุฃู /settings
3. ุงููุชูุฌุฉ ุงููุชููุนุฉ:
   - ุฑุณุงูุฉ: "Permission Denied"
   - ุชูุฌูู ุฅูู Dashboard

โ ุงูุชุญูู ูู ุงูุตูุงุญูุงุช ูุนูู
```

---

## Troubleshooting

### โ ุงููุดููุฉ: ุงููุธุงู ููุชุญ ุจุฏูู ุชุณุฌูู ุฏุฎูู

```bash
ุงูุญู:
1. ุชุญูู ูู .env.local:
   - SKIP_MIDDLEWARE ูุฌุจ ุฃูุง ูููู ููุฌูุฏ
   - DEV_COOKIE_VERSION ููุฌูุฏ

2. ุฃุนุฏ ุชุดุบูู ุงูุฎุงุฏู:
   npm run dev

3. ุงูุณุญ ูุงุด ุงููุชุตูุญ

4. ุฌุฑุจ ูุฑุฉ ุฃุฎุฑู ูู Incognito
```

### โ ุงููุดููุฉ: ูุทูุจ ุชุณุฌูู ุฏุฎูู ุจุดูู ูุชูุฑุฑ

```bash
ุงูุญู:
1. ุชุญูู ูู NEXTAUTH_SECRET ูู .env.local
2. ุชุญูู ูู ุฃู Cookies ููุนูุฉ ูู ุงููุชุตูุญ
3. ุชุญูู ูู ุนุฏู ูุฌูุฏ ุฃุฎุทุงุก ูู Console
4. ุชุฃูุฏ ูู ุฃู maxAge ูุงูู ูู auth.ts
```

### โ ุงููุดููุฉ: ุจุนุฏ ุงูุชุญุฏูุซุ ุฌููุน ุงููุณุชุฎุฏููู ููุฏูุง ุงูุฌูุณุงุช

```bash
ุงูุณุจุจ: ุชู ุชุบููุฑ DEV_COOKIE_VERSION
ุงูุญู: ูุฐุง ูุชููุน! ุงูุฌููุน ูุญุชุงุฌ ูุชุณุฌูู ุฏุฎูู ุฌุฏูุฏ
```

---

## Checklist ุงูููุงุฆู

ูุจู ูุดุฑ ุงููุธุงู ููุฅูุชุงุฌุ ุชุญูู ูู:

- [ ] โ ุฌููุน ุงูุงุฎุชุจุงุฑุงุช ุฃุนูุงู ูุฌุญุช
- [ ] โ NEXTAUTH_SECRET ููู ูุขูู
- [ ] โ NEXTAUTH_URL ูุดูุฑ ููุฏูููู ุงูุตุญูุญ
- [ ] โ Secure cookies ููุนูุฉ (ูู ุงูุฅูุชุงุฌ)
- [ ] โ Session maxAge ููุงุณุจ (7 ุฃูุงู ููุฅูุชุงุฌ)
- [ ] โ Middleware ูุง ูููู ุชุฎุทูู
- [ ] โ ุฌููุน API routes ูุญููุฉ
- [ ] โ Activity logging ูุนูู ุจุดูู ุตุญูุญ
- [ ] โ Security headers ููุฌูุฏุฉ
- [ ] โ ูุง ุชูุฌุฏ ุฃุฎุทุงุก ูู Console

---

## ูุชูุฌุฉ ุงูุงุฎุชุจุงุฑุงุช

| ุงูุงุฎุชุจุงุฑ | ุงูุญุงูุฉ | ููุงุญุธุงุช |
|---------|--------|---------|
| ุงููุตูู ุจุฏูู login | โฌ | |
| ูุณุญ ุงููุงุด | โฌ | |
| Middleware protection | โฌ | |
| Session validation API | โฌ | |
| Session versioning | โฌ | |
| Security headers | โฌ | |
| ููุน /login ุจุนุฏ ุงูุฏุฎูู | โฌ | |
| ุชุชุจุน ุงููุญุงููุงุช ุงููุงุดูุฉ | โฌ | |
| Session caching | โฌ | |
| Activity logging | โฌ | |
| ุชุณุฌูู ุงูุฎุฑูุฌ | โฌ | |
| ูุญุงููุงุช ุฎุงุทุฆุฉ | โฌ | |
| ุงูุตูุงุญูุงุช | โฌ | |

โ ุถุน ุนูุงูุฉ ุตุญ (โ๏ธ) ุนูู ูู ุงุฎุชุจุงุฑ ุจุนุฏ ุงููุฌุงุญ

---

**ููุงุญุธุฉ:** ุฅุฐุง ูุฌุญุช ุฌููุน ุงูุงุฎุชุจุงุฑุงุชุ ุงููุธุงู ุฌุงูุฒ ููุงุณุชุฎุฏุงู! ๐